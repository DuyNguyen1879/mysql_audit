# SQL规范

## 建表规范
1. 使用Innodb引擎，MyISAM不要在使用
2. 为每个表设置一个自增的主键，如：id int unsigned not null primary key auto_increment
3. 选用合适的字段类型
> 1. 整型

| 类型 | 存储 | 最小值 | 最大值 |
|  | (Bytes) | (Signed/Unsigned) | 最大值 |
|---|
|   |


## 一、概览信息


## 二、平台相关介绍

### 1、自动审核平台功能
1）自动审核上线SQL，存在问题的SQL提前发现
> 1. 终于再也不会因为提交的SQL有问题被打回了,DBA也不用肉眼区分中文; 空白符
> 2. DBA也不用面对工单找提单人修改不符合规范的SQL，因为不符合规范的SQL被拦截了^_^

2）线上、测试环境表结构不一致导致提供的SQL不能执行
> 1. 线下测试很完美的SQL为啥到了线上就不能执行，这个是一个很容易导致问题的原因

3）限制修改(update,delete)影响最大行数，避免导致对线上服务抖动
> 1. 对线上数据量评估不足，根据条件修改数据影响范围很大，用了这个平台再也用担心这个问题，它会对你的影响范围进行评估

4）避免无效沟通，提高上线效率
> 1. 每次提交一个申请，都要把工单地址发给DBA催促执行,现在DBA可以收到通知了，不用你盯着干活了
> 2. DBA发现SQL有问题或者不符合规范，打回修改，返工，在修改，如此循环，心累了.....

5）可以自动备份数据，可以快速回滚
> 1. 上线完毕后发现修改的数据出了问题是最让人抓狂的事请，血压立马升高，赶紧写回滚SQL修复，现在这种问题不会出现了，平台自动帮你备份DML影响的数据，直接可以瞬间回退到修改前的数据，已经有小伙伴使用过了，可以问下是不是感觉很顺畅 ^_^

### 2、自动审核平台使用方式
> step 1. 登录审核平台，已经接入SSO，使用域账号密码即可
> step 2. 选择发起上线SQL选项卡进行操作
> step 3. 把测试好的SQL复制到相应地方进行自动审核，通过自动化审核的语句块是浅绿色的提示背景，显示结果为None，否则有相应的修改提示
> step 4.审核通过后，直接提交，提交后DBA会直接处理


### 3、自动化审核要点
> 1、检查SQL语法 ,语义
> 2、合法标识符检测：库表名称必须为 数字、字母、下划线的组合
> 3、备注检测：创建，修改表字段是必须有注释
> 4、外键检测：不支持外键
> 5、索引检测：普通索引前缀idx_ ，检查唯一索引前缀uniq_，创建表必须有主键，单个所以最大包含5个字段，一个表最多16个索引
> 6、自增列检测：创建表自增id 必须从0 开始，自增列必须为 int ，bigint 无符号型
> 7、表引擎检测：alter， create是引擎必须为 innodb
> 8、字符集检测：只支持utf8mb4
> 9、影响范围加测：单个update语句最多能影响2000行，dml必须有where条件，select语句必须明确指定列名称，禁止用*代表全部字段，插入数据必须指定列名称
> 10、同类DDL合并检测：同一次提交对同一个表的ddl必须合并到一起
> <font color=red>***Note 1:请在提交的SQL语句块表明使用的数据库,即 use db; ,该分号不可省略*** </font>
> <font color=red>***Note 2:为了避免时区问题，timestamp必须使用bigint进行存储*** </font>

###3、平台使用限制
> 1.不支持分区表的创建、修改操作
> 2.不支持JSON
> 3.不支持申请数据库权限操作
> <font color=red>***如果出现这些那申请，还请大家暂时走提普通工单的流程，我们会在近期改进*** </font>
> 
### 6、小提示
> 1. 使用前一定要仔细阅读自动化审核必读，因为平台是按照这个规范审核的，它会帮你很容易的通过自动审核
> 2. 登录出现AccessProxy：Access denied！请联系安全组解决
> 3. 一定要选择备份功能，这样我们才会去备份数据

